---
name: 简单解释进程、线程、协程
title: 简单解释进程、线程、协程
tags: ["技术", "瞎折腾"]
categories: 学习笔记
info: "菜桌、菜盘和夹菜顺序"
time: 2021/11/6
desc: '进程、线程、协程'
keywords: ['前端', '进程、线程、协程', '学习笔记']
---

# 简单解释进程、线程、协程

> 参考资料：
>
> - [线程和协程的区别的通俗说明](https://zhuanlan.zhihu.com/p/169426477)
> - [Node.js 真的有协程吗？](https://www.zhihu.com/question/305443189/answer/551716136?utm_source=wechat_timeline&utm_medium=social&utm_oi=1091714646783979520)

简单来说，线程是计算机执行任务的最小单元，CPU 的每个核在线程这个概念上进行工作。

而进程是操作系统调度的一个概念，一个进程中可能拥有多个线程，而这个进程中的多个线程（至少有一个）会共享由操作系统分配下来的同一片内存空间及变量。

具体在使用时，多进程之间的变量是互相独立的，不同进程的线程想要通信只能通过操作系统提供的一些特有的方式（如信道等等）。而单个进程中的多个线程是共享变量的，但也正因为如此，在两个线程访问同一个变量的时候会有可能导致冲突，一般各个支持多线程的语言都会引入“锁”机制来确保变量不会被同时被多个线程修改。

多进程和多线程在切换执行时都会带来额外的开销，但由于并不需要切换内存空间，相对来说线程的切换代价要小得多。

---

而协程并不涉及线程和进程的概念，只是语言的引擎对于多个异步任务的一种同步处理方式。

它是各个语言的执行引擎提供的一种机制，来替代回调的代码编写方式。从而让开发者能够更多的使用同步代码的编写方式来使用异步的接口（个人认为可以参考 ES7 的 async/await，还有 node.js 的 promisify`const { promisify } = require('util')`，就是一种协程的实现）。

但与回调稍微有些不同的是，实现了协程的语言会在切换执行函数时做更多的事情（方法间挂起与切换上下文：先检查函数类型，是否可以被暂停，resumable。创建 JSGeneratorObject 对象，保护现场，运行。），而不是单纯的保存函数指针并执行。

> 到底是不是“真·协程”，要看看引擎有多努力，看看方法有没有被挂起，函数执行结束后有没有恢复上下文。

> 协程应该有个明确的定义，这个问题才好讨论。不然你想想，go 语言那种 goroutine，也配叫协程？协程和进程、线程的区别就是两点 -- 是否隔离变量，是否自动切换运行上下文。满足这两点区别的，就是协程。
>
> - 进程：变量隔离，自动切换运行上下文
> - 线程：不变量隔离，自动切换运行上下文切换
> - 协程：不变量隔离，不自动切换运行上下文切换

