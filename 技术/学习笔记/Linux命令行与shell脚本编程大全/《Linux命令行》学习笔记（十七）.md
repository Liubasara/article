---
name: 《Linux命令行》学习笔记（十七）
title: 《Linux命令行》学习笔记（十七）
tags: ["技术","学习笔记","Linux命令行与shell脚本编程大全"]
categories: 学习笔记
info: "第20章 正则表达式、第21章 sed 进阶"
time: 2020/6/30
desc: 'Linux命令行与shell脚本编程大全, 资料下载, 学习笔记, 第20章 正则表达式, 第21章 sed 进阶'
keywords: ['Linux命令行与shell脚本编程大全', 'shell学习', '学习笔记', '第20章 正则表达式', '第21章 sed 进阶']
---

# 《Linux命令行》学习笔记（十七）

## 第 20 章 正则表达式

在 shell 脚本中使用 sed 编辑器和 gawk 编辑器关键在于熟练使用正则表达式，本章介绍正则。

**PS**：本章不会详细阅读

### 20.2 定义 BRE 模式

#### 20.2.2 特殊字符

正则表达式识别的特殊字符包括：`.*[]^${}\+?|()`

> 如果要用某个特殊字符作为文本字符，就必须转义。在转义特殊字符时，你需要在它前面加 一个特殊字符来告诉正则表达式引擎应该将接下来的字符当作普通的文本字符。这个特殊字符就是反斜线（\）。 

#### 20.2.6 排除型字符组

也可以使用正则表达式来寻找组中没有的字符，而不是去寻找组中含有的字符。

```shell
# 以下正则表达式模式会匹配 c 或 h 之外的任何字符以及文本模式
# 这里的 ^ 代表的不是字符开头，而是配合 [] 区间字符进行取反的意思
sed -n '/[^ch]at/p' data6
```

#### 20.2.7 区间

一些常用区间：

- [0-9] 数字区间

- [a-z] 字母区间

  [a-ch-m] 该区间允许字母 a~c、h~m 匹配，但不允许出现 d~g 之间的字母

## 第21章 sed 进阶

**PS**：本章只会记录一些高级的实用命令行。

```shell
# 在不删除其他空白行的情况下只删除第一个空白行
sed '/^$/{N ; /header/D}' data.txt
```

#### 21.1.1 n命令：下一行文本

`n`命令会让编辑器移动到文本的下一行。

```shell
# 找到匹配 dog 的下一行并删除
sed '{/dog/n
> d'} data.txt
#dog
#dog
#dog
```

### 21.3 排除命令

```shell
# 命令取反，除了包含单词 header 那一行外，文件中其他所有的行都被打印出来了
sed -n '/header/!p' data2.txt
```

#### 21.4.2 t命令：测试命令

```shell
# 第一个替换命令会查找模式文本first。如果匹配了行中的模式，它就会替换文本，而且测试命令会跳过后面的替换命令
# 如果第一个替换命令未能匹配模式，第二个替换命令就会被执行。
sed '{
> s/first/matched/
> t
> s/cat/dog/
> }' data.txt
#dog
#dog
#dog
#dog
#dog
#dog
```

#### 21.5.1 &符号

`&`符号允许你用该符号来代表被替换的符号，在使用正则模式进行替换的时候非常有用。

假如，现在想在行中匹配的单词两边上放上引号。如果你只是要匹配模式中的一个单词，那非常简单。

```shell
echo "The cat sleeps in his hat." | sed 's/cat/"cat"/'
# The "cat" sleeps in his hat.
```

但如果你想用通配符(`.`)来匹配多个单词呢，`echo "The cat sleeps in his hat." | sed 's/.at/".at"/'`很遗憾像这样的命令并无法生效。

这种情况下我们可以就可以使用`&`符号。

```shell
echo "The cat sleeps in his hat." | sed 's/.at/"&"/g'
# The "cat" sleeps in his "hat".
```

如上，`&`符号替代了符合正则的 cat 和 hat 这两个单词并成功用引号将其替换。

#### 21.5.2 \1 \2 替换单独单词

可以使用 \1 \2 这种模式来指定要替换的字符，方便组织替换后的格式，但是在使用之前，需要先用圆括号将要替换的字符框起来，如下：

```shell
 # 令用一对圆括号将单词System括起来，将其标示为一个子模式
 # 然后在替代模式中使用 \1 来提取第一个匹配的子模式
 echo "The System Administrator manual" | sed 's/\(System\) Administrator/\1 User/'
 # The System User manual
```

> 当在替换命令中使用圆括号时，必须用转义字符将它们标示为分组字符而不是普通的圆括号。这跟转义其他特殊字符正好相反。 

### 21.7 sed 实用工具

```shell
# 向文本文件的行间插入空白行的简单sed脚本
# G 命令会简单地将 保持空间 中的内容附加到模式空间内容后。当启动sed编辑器时，保持空间只有一个空行。
sed 'G' data.txt
# 可以用排除符号（!）和尾行符号（$）来确 保脚本不会将空白行加到数据流的后一行后面
sed '$!G' data2.txt
# 为防止原本就是空白行的行数也被加入空白行，首先删除数据流中的所有空白行，然后用G命令在所有行后插入新的空白行
sed '/^$/d ; $!G' data6.txt
# 展示内容同时展示行号，效果等同于 cat -n
sed '=' data2.txt | sed 'N; s/\n/ /' 
# 展示行末尾，N 翻页，q 退出，等同于 tail 命令
sed '{
> :start
> $q ; N ; 11,$D
> b start
> }' data7.txt
# 删除连续空白行
sed '/./,/^$/!d' data8.txt
# 删除开头的空白行
sed '/./,$!d' data9.txt
# 删除结尾的空白行
sed '{
> :start
> /^\n*$/{$d; N; b start }
> }' data10.txt
# 删除 HTML 标签和多余的空白行
sed 's/<[^>]*>//g ; /^$/d' data11.txt
```


