---
name: 《Linux命令行》学习笔记（十五）
title: 《Linux命令行》学习笔记（十五）
tags: ["技术","学习笔记","Linux命令行与shell脚本编程大全"]
categories: 学习笔记
info: "第17章 创建函数"
time: 2020/6/23
desc: 'Linux命令行与shell脚本编程大全, 资料下载, 学习笔记, 第17章 创建函数'
keywords: ['Linux命令行与shell脚本编程大全', 'shell学习', '学习笔记', '第17章 创建函数']
---

# 《Linux命令行》学习笔记（十五）

---

第三部分 高级 shell 脚本编程

---

## 第17章 创建函数

> 本章内容：
>
> - 基本的脚本函数
> - 返回值
> - 在函数中使用变量
> - 数组变量和函数
> - 函数递归
> - 创建库
> - 在命令行上使用函数

本章将会带你逐步了解如何创建自己的 shell 脚本函数，并演示如何使用他们。

### 17.1 基本的脚本函数

#### 17.1.1 创建函数

有**两种格式**可以用来在 bash shell 中创建函数。

```shell
# 方式1，使用关键字 function
function name {
	# commands
}
# 方式2，使用空括号定义
name() {
	# commands
}
```

#### 17.1.2 使用函数

只需要像其他 shell 命令一样在行中指定函数名就可以使用函数。

```shell
function func1 {
	echo "函数1"
}
count=1
while [ $count -le 5 ]
do
	# 调用函数
	func1
	count=$[ $count + 1 ]
done
echo "结束"
```

> **一定要小心，如果在函数被定义前使用函数，你会收到一条错误消息**。
>
> 此外，你也必须注意函数名。记住，函数名必须是唯一的，否则也会有问题。如果你重定义了函数， 新定义会覆盖原来函数的定义，这一切不会产生任何错误消息。

### 17.2 返回值

bash shell 会把函数当成一个小型脚本，运行结束时会返回一个退出状态吗。

#### 17.2.1 默认退出状态码

默认情况下，**函数的退出状态码事函数种最后一条命令返回的退出状态码，在函数结束后，可以用标准变量`$?`来确定函数的退出状态码**。

```shell
#!/bin/bash
func1 () {
	ls -alF 不存在的文件
	echo "hi"
}

func2 () {
	echo "hi"
	ls -alF 不存在的文件	
}

func1
echo $?
func2
echo $?
```

执行上述脚本，可以发现函数 func1 返回的状态码是 0，而 func1 的返回状态码是 1，这意味着默认情况下，你只能知道函数中最后一条命令的执行状况而无法知道函数中其他命令是否成功运行。

#### 17.2.2 使用 return 命令

`return`命令可以用来退出函数并返回特定的退出状态码。

```shell
function dbl {
	read -p "请输入一个需要被 dobule 的值：" value
	return $[ $value * 2 ]
}
dbl
echo "dobule 后的值为：$?"
```

当用这种方法从函数中返回值时，要注意两个问题：

- 必须在函数一结束就调用`$?`取返回值，如果在用`$?`变量提取函数返回值之前执行了其他命令，函数的返回值就会丢失
- 退出状态码必须是 0 ～255，如果大于这个值，就会产生错误，从而使`$?`的值变为 1
- 此外，要返回较大的整数值或者字符串值的话，你就不能用这种返回值的方法了。

#### 17.2.3 使用函数输出

可以使用`$()`这种方式来获得任何类型的函数输出，并将其保存到变量中。

```shell
#!/bin/bash
function dbl {
	read -p "输入一个值：" value
	echo $[ $value * 2 ]
}
result=$(dbl)
echo "dobule 的值为 $result"
```

新函数会用 echo 语句来显示计算的结果。该脚本会获取dbl函数的输出，而不是查看退出状态码。

> 这个例子中演示了一个不易察觉的技巧。你会注意到dbl 函数实际上输出了两条消息。read 命令输出了一条简短的消息来向用户询问输入值。bash shell脚本非常聪明，并不将其作为STDOUT 输出的一部分，并且忽略掉它。
>
> **如果你用echo语句生成这条消息来向用户查询，那么它会与输出值一起被读进shell变量中**。

### 17.3 在函数中使用变量









> 本次阅读至 P362 377