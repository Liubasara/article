---
name: 红宝书学习笔记（八）
title: 红宝书（javascirpt高级程序设计）学习笔记（八）
tags: ['读书笔记', '红宝书', 'javascript高级程序设计']
categories: 学习笔记
info: "人类的好伙伴，红宝书（八）"
time: 2019/2/1
desc: 'javascirpt高级程序设计, 红宝书, 资料下载, 学习笔记, 第11章'
keywords: ['前端', '红宝书笔记', '学习笔记', '第11章 DOM扩展']
---

# 红宝书（javascirpt高级程序设计）学习笔记（八）

## 第11章 DOM扩展

对```DOM```两个主要的扩展是Selectors API（选择符API）和HTML5。此外还有一些个别浏览器转有的扩展。

### 11.1 选择符API

Selectors API LEVEL 1 的核心是两个方法：querySelector() 和 querySelectorAll() 。

#### 11.1.1 querySelector()方法

*querySelector()* 方法接收一个CSS选择符，返回与该模式匹配的**第一个**元素，如果没有找到匹配的元素，**返回null**。

```javascript
// 取得body元素
var body = document.querySelector("body")
// 取得ID为"myDiv"的元素
var myDiv = document.querySelector("#myDiv")
// 取得类为"selected"的第一个元素
var selected = document.querySelector(".selected")
// 取得类为"button"的第一个图像元素
var img = document.body.querySelector("img.button")
```

如果传入了不被支持的选择符，querySelector() 会抛出错误。

能够调用 querySelector() 方法的类型包括Document、DocumentFragment和Element。

#### 11.1.2 querySelectorAll() 方法

querySelectorAll() 接收一个与上面一样的参数，返回一个 NodeList 的实例，里面包含了所有匹配的元素。如果没有找到，**返回一个空的NodeList。**

和 querySelector 类似，能够调用 querySelectorAll() 方法的类型包括Document、DocumentFragment和Element。

#### 11.1.3 matchesSelector() 方法

该方法接收一个CSS选择符，如果调用元素与该选择符匹配，返回 true ，否则返回 false。

```javascript
if (document.body.matchesSelector("body.page1")) {
    // true
}
```

在取得了某个元素引用的情况下，使用这个方法能够方便地检测它是否会被 querySelector() 或 quereySelectorAll() 方法返回。

### 11.2 元素遍历

Element Traversal API为DOM元素添加了5个属性：

- childElementCount：返回子元素（不包括文本节点和注释）的个数
- firstElementChild：指向第一个子元素
- lastElementChild: 指向最后一个子元素
- previousElementSibling: 指向前一个同辈元素
- nextElementSibling：指向后一个同辈元素

### 11.3 HTML5

在这里只讨论与DOM节点相关的HTML5的内容。

#### 11.3.1 与类相关的扩充

1. getElementsByClassName() 方法

   可以通过document对象及所有HTML元素调用该方法。

   ```javascript
   // 取得所有类中包含"username"和"current"的元素，类名先后顺序无所谓
   var allCurrentUsernames = document.getElementByClassName("username current")
   // 取得ID为"myDiv"的元素中带有类名"selected"的所有元素
   var selected = document.getElementById("myDiv").getElementByClassName("selected")
   ```

   跟之前的一样，返回的也是一个nodelist

2. classList 属性

   使用classList属性可以增删查改当前元素的class值。classList属性是新集合类型DOMTokenList的实例。该新类型有几种方法：

   - add
   - contains：表示列表中是否存在给定的值，存在返回true，否则返回false。
   - remove
   - toggle：如果列表中已经存在给定的值，删除它；如果列表中没有给定的值，添加它。

#### 11.3.2 焦点管理

- document.activeElement：该属性始终会引用DOM中当前获得了焦点的元素，默认情况下，文档刚刚加载完成时，document.activeElement中保存的是document.body元素的引用。文档加载期间，它的值为null。
- document.hasFocus()：该方法用于确定文档是否获得了焦点。

#### 11.3.3 HTMLDocument 的变化

HTML5 扩展了HTMLDocument，增加了新的功能。

1. readyState属性

   这个属性有两个可能的值：

   - loading 正在加载文档
   - complete 已经加载完文档

   使用 *document.readyState* 的最恰当方式，是通过它来实现一个指示文档已经加载完成的指示器。

   ```javascript
   if (document.readyState == "complete") {
       // 执行操作
   }
   ```

   而在这个属性泛用之前，要实现这样一个标签，必须借助 onload 事件设置一个标签。

2. 兼容模式

   在标准模式下，document.compatMode的值为"CSS1Compat"，而在混杂模式下，它的值等于 "BackCompat"

3. head 属性

   HTML5加入了document.head用于调用页面的head元素。

#### 11.3.4 字符集属性

document.charset 属性表示文档中实际使用的字符集，其默认为"UTF-16"

#### 11.3.5 自定义数据属性

HTML5规定可以为元素添加非标准属性，但要添加前缀 *data-* ，目的是为元素提供与渲染无关的信息，或者提供语义信息，如下面这个例子。

```html
<div id="myDiv" data-myname="Nicholas"></div>
```

这种非标准自定义属性除了可以通过 *element.getAttribute("data-myname")* 以外，还可以通过元素的dataset属性，通过 *element.dataset.myname* 拿到。

dataset属性的值是DOMStringMap的一个实例，也是一个名值对的映射，在这个映射中，每个data-name形式的属性都会有一个对应的属性，只不过属性名没有 data- 前缀。

通过自定义数据属性，可以给元素添加一些不可见的数据以便进行其他处理。

> 本次阅读应至P294 11.3.6 插入标记 313