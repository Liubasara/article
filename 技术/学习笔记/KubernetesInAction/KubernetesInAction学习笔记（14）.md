---
name: KubernetesInActionå­¦ä¹ ç¬”è®°ï¼ˆ14ï¼‰
title: KubernetesInActionå­¦ä¹ ç¬”è®°ï¼ˆ14ï¼‰
tags: ["æŠ€æœ¯","å­¦ä¹ ç¬”è®°","KubernetesInAction"]
categories: å­¦ä¹ ç¬”è®°
info: "ç¬¬14ç«  è®¡ç®—èµ„æºç®¡ç†"
time: 2021/3/4
desc: 'kubernetes in action, èµ„æ–™ä¸‹è½½, å­¦ä¹ ç¬”è®°'
keywords: ['kubernetes in action', 'k8så­¦ä¹ ', 'å­¦ä¹ ç¬”è®°']
---

# KubernetesInActionå­¦ä¹ ç¬”è®°ï¼ˆ14ï¼‰

## ç¬¬14ç«  è®¡ç®—èµ„æºç®¡ç†

åœ¨æœ¬ç« ä¼šå­¦ä¹ å¦‚ä½•ä¸º pod é…ç½®èµ„æºé¢„æœŸçš„ CPU å’Œå†…å­˜ä½¿ç”¨é‡ï¼Œä»¥ç¡®ä¿ pod å¯ä»¥å…¬å¹³åœ°ä½¿ç”¨ K8S é›†ç¾¤èµ„æºï¼ŒåŒæ—¶ä¹Ÿå½±å“æ•´ä¸ªé›†ç¾¤ pod çš„è°ƒåº¦æ–¹å¼ã€‚

### 14.1 ä¸º pod ä¸­çš„å®¹å™¨ç”³è¯·èµ„æº

ä½¿ç”¨`pod.spec.containers.resources.requests`å­—æ®µå¯ä»¥ä¸ºå…¶æŒ‡å®š CPU å’Œå†…å­˜çš„èµ„æºè¯·æ±‚é‡ã€‚

![code-14-1.png](./images/code-14-1.png)

ä¸Šé¢æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå®¹å™¨éœ€è¦ 1/5 æ ¸ï¼ˆ200 æ¯«æ ¸ï¼‰çš„ CPU æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚æ¢å¥è¯è¯´ï¼Œäº”ä¸ªåŒæ ·çš„ podï¼ˆæˆ–å®¹å™¨ï¼‰å¯ä»¥è¶³å¤Ÿå¿«åœ°è¿è¡Œåœ¨ä¸€ä¸ª CPU æ ¸ä¸Šã€‚

æ­¤å¤–è¿˜ä¸ºå®¹å™¨ç”³è¯·äº† 10MB çš„å†…å­˜ï¼Œè¯´æ˜æœŸæœ›å®¹å™¨å†…çš„è¿›ç¨‹æœ€å¤§æ¶ˆè€— 10MB çš„ RAMã€‚

#### 14.1.2 èµ„æº requests å¦‚ä½•å½±å“è°ƒåº¦

é€šè¿‡è®¾ç½®èµ„æº requests æˆ‘ä»¬æŒ‡å®šäº† pod å¯¹èµ„æºéœ€æ±‚çš„æœ€å°å€¼ï¼Œè°ƒåº¦å™¨ä¼šåœ¨è°ƒåº¦çš„è¿‡ç¨‹ä¸­ç”¨åˆ°è¯¥ä¿¡æ¯ï¼Œåªè€ƒè™‘é‚£äº›æœªåˆ†é…èµ„æºé‡æ»¡è¶³ pod éœ€æ±‚é‡çš„èŠ‚ç‚¹ã€‚å¦‚æœèŠ‚ç‚¹çš„æœªåˆ†é…èµ„æºé‡å°äº pod éœ€æ±‚é‡ï¼ŒK8S å°±ä¸ä¼šå°†è¯¥ pod è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ã€‚

##### è°ƒåº¦å™¨å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª pod æ˜¯å¦é€‚åˆè°ƒåº¦åˆ°æŸä¸ªèŠ‚ç‚¹

æ¯”è¾ƒæ„å¤–çš„æ˜¯ï¼Œè°ƒåº¦å™¨åœ¨è°ƒåº¦çš„æ—¶å€™**å¹¶ä¸ä¼šå…³æ³¨å„ç±»èµ„æºåœ¨å½“å‰æ—¶åˆ»çš„å®é™…ä½¿ç”¨é‡**ï¼Œè€Œåªä¼šå…³å¿ƒ**èŠ‚ç‚¹ä¸Šéƒ¨ç½²çš„æ‰€æœ‰ pod èµ„æºç”³è¯·é‡ä¹‹å’Œ**ã€‚

![14-1.png](./images/14-1.png)

##### è°ƒåº¦å™¨å¦‚ä½•åˆ©ç”¨ pod requests ä¸ºå…¶é€‰æ‹©æœ€ä½³èŠ‚ç‚¹

åœ¨è°ƒåº¦æ—¶è°ƒåº¦å™¨ä¼šå…ˆæ’é™¤é‚£äº›ä¸æ»¡è¶³éœ€æ±‚çš„èŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨ä¼˜å…ˆçº§å‡½æ•°å¯¹å…¶ä½™èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œåœ¨ K8S ä¸­æœ‰ä¸¤ç§åŸºäºèµ„æºè¯·æ±‚é‡çš„ä¼˜å…ˆçº§æ’åºï¼š

- LeastRequestedPriorityï¼šä¼˜å…ˆå°† pod è°ƒåº¦åˆ°è¯·æ±‚é‡å°‘çš„èŠ‚ç‚¹ä¸Š
- MostRequestedPriorityï¼šä¼˜å…ˆå°† pod è°ƒåº¦åˆ°è¯·æ±‚é‡å¤šçš„èŠ‚ç‚¹ä¸Š

ä½¿ç”¨ LeastRequestedPriority å¯ä»¥ç†è§£ï¼Œä½†æ˜¯ MostRequestedPriority ä¼šåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ã€‚ç­”æ¡ˆæ˜¯å½“ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„äº‘æœåŠ¡æ—¶ï¼Œéœ€è¦ä¸ºæ¯ä¸ª pod æä¾›è¶³é‡ CPU/å†…å­˜èµ„æºçš„åŒæ—¶ï¼Œç¡®ä¿ K8S ä½¿ç”¨å°½å¯èƒ½å°‘çš„èŠ‚ç‚¹ï¼ˆèŠ‚çœå¼€é”€ï½ï¼‰ã€‚

##### æŸ¥çœ‹èŠ‚ç‚¹èµ„æºæ€»é‡

ä½¿ç”¨ describe å‘½ä»¤å¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹çš„èµ„æºã€‚

![code-14-3.png](./images/code-14-3.png)

#### 14.1.3 CPU requests å¦‚ä½•å½±å“ CPU æ—¶é—´åˆ†é…

CPU requests ä¸ä»…ä»…åœ¨è°ƒåº¦æ—¶èµ·ä½œç”¨ï¼Œå®ƒè¿˜å†³å®šç€å‰©ä½™çš„ CPU æ—¶é—´å¦‚ä½•åœ¨ pod ä¹‹é—´åˆ†é…ã€‚å¦‚æœè¯´ä¸€ä¸ª pod è¯·æ±‚äº† 200 æ¯«æ ¸ï¼Œå¦ä¸€ä¸ªè¯·æ±‚äº† 1000 æ¯«æ ¸ã€‚é‚£ä¹ˆæœªä½¿ç”¨çš„ CPU å°†æŒ‰ç…§ 1:5 çš„æ¯”ä¾‹æ¥åˆ†ç»™è¿™ä¸¤ä¸ª podã€‚

![14-2.png](./images/14-2.png)

#### 14.1.4 å®šä¹‰å’Œç”³è¯·è‡ªå®šä¹‰èµ„æº

K8S å…è®¸ç”¨æˆ·æ·»åŠ å±äºè‡ªå·±çš„è‡ªå®šä¹‰èµ„æºï¼Œå¹¶åœ¨ spec çš„ resource.requests å­—æ®µä¸‹æ¥æŒ‡å®šåˆ›å»º pod çš„ç”³è¯·é‡ã€‚

### 14.2 é™åˆ¶å®¹å™¨çš„å¯ç”¨èµ„æº

requests å’Œ limits é™åˆ¶æ˜¯ä¸ä¸€æ ·çš„ï¼Œrequests é™¤äº†ä¼šå£°æ˜ pod ä½¿ç”¨çš„ç¡¬ä»¶èµ„æºå¤–ï¼Œå¹¶ä¸ä¼šç¡¬æ€§é™åˆ¶ pod çš„æœ€å¤§ä½¿ç”¨é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“èŠ‚ç‚¹çš„ CPU å’Œå†…å­˜æœ‰ç©ºä½™çš„æ—¶å€™ï¼Œä¼šå…è®¸ pod å¯¹å®ƒä»¬è¿›è¡Œä¸»åŠ¨çš„å ç”¨ã€‚

å¦‚æœè¦é™åˆ¶å®¹å™¨å¯ä»¥æ¶ˆè€—èµ„æºçš„æœ€å¤§é‡ï¼Œå°±å¿…é¡»è¦ä½¿ç”¨ limits å­—æ®µã€‚

#### 14.2.1 è®¾ç½®å®¹å™¨å¯ä½¿ç”¨èµ„æºé‡çš„ç¡¬é™åˆ¶

å†…å­˜æ˜¯ä¸€ç§ä¸å¯å‹ç¼©èµ„æºï¼Œåœ¨è¢«å ç”¨çš„è¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾ä¹‹å‰éƒ½æ— æ³•è¢«å›æ”¶ï¼Œå¦‚æœä¸å¯¹å†…å­˜è¿›è¡Œé™åˆ¶ï¼Œå·¥ä½œèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ï¼ˆæˆ–è€… podï¼‰å¯èƒ½ä¼šåƒæ‰æ‰€æœ‰çš„å¯ç”¨å†…å­˜ç”šè‡³å¯¼è‡´æ•´ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œæ‰€ä»¥åŠ¿å¿…éœ€è¦é™åˆ¶å®¹å™¨çš„æœ€å¤§å†…å­˜åˆ†é…é‡ã€‚

##### åˆ›å»ºä¸€ä¸ªå¸¦æœ‰èµ„æº limits çš„ pod

![code-14-7.png](./images/code-14-7.png)

ä¸Šé¢çš„ manifest è§„å®šäº†å®¹å™¨å†…çš„è¿›ç¨‹ä¸å…è®¸æ¶ˆè€—è¶…è¿‡ 1 æ ¸ CPU å’Œ 20MB å†…å­˜ã€‚

> PSï¼šå¦‚æœæ²¡æœ‰æŒ‡å®šèµ„æº requestsï¼Œå®ƒå°†è¢«è®¾ç½®ä¸ºèµ„æº limits ç›¸åŒçš„å€¼

##### å¯è¶…å–çš„ limits

ä¸ requests ä¸åŒçš„æ˜¯ï¼Œlimits ä¸å—èŠ‚ç‚¹å¯åˆ†é…èµ„æºé‡çš„çº¦æŸï¼Œæ‰€æœ‰ limits çš„æ€»å’Œå…è®¸è¶…è¿‡èŠ‚ç‚¹èµ„æºæ€»é‡çš„ 100%ã€‚ä½†å¦‚æœèŠ‚ç‚¹èµ„æºä½¿ç”¨é‡è¶…è¿‡äº† 100%ï¼Œå°±ä¼šæœ‰ä¸€äº›å®¹å™¨è¢«æ€æ‰ã€‚

![14-3.png](./images/14-3.png)

#### 14.2.2 è¶…è¿‡ limits

å› ä¸º CPU æ˜¯å¯å‹ç¼©èµ„æºï¼Œå½“è¿›ç¨‹ä¸ç­‰å¾… IO æ“ä½œæ—¶æ¶ˆè€—æ‰€æœ‰çš„ CPU æ—¶é—´æ˜¯éå¸¸å¸¸è§çš„ï¼Œå› æ­¤å½“ä¸ºä¸€ä¸ªå®¹å™¨è®¾ç½® CPU é™é¢æ—¶ï¼Œè¯¥è¿›ç¨‹åªä¼šåˆ†ä¸åˆ°æ¯”é™é¢æ›´å¤šçš„ CPU è€Œå·²ã€‚

ä½†å†…å­˜å´æœ‰æ‰€ä¸åŒï¼Œå½“è¿›ç¨‹å°è¯•ç”³è¯·åˆ†é…æ¯”é™é¢æ›´å¤šçš„å†…å­˜æ—¶ä¼šè¢«æ€æ‰ã€‚å¦‚æœ pod çš„é‡å¯ç­–ç•¥ä¸º Always æˆ– OnFailureï¼Œè¿›ç¨‹å°†ä¼šç«‹å³é‡å¯ï¼Œå¦‚æœå®ƒç»§ç»­è¶…é™å¹¶è¢«æ€æ­»ï¼Œpod å°†ä¼šå¤„äº CrashLoopBackOff çš„çŠ¶æ€ã€‚

CrashLoopBackOff çŠ¶æ€è¡¨ç¤º Kubelet è¿˜æ²¡æœ‰æ”¾å¼ƒï¼Œå®ƒä»£è¡¨**åœ¨æ¯æ¬¡å´©æºƒä¹‹åï¼ŒKubelet å°±ä¼šå¢åŠ ä¸‹æ¬¡é‡å¯ä¹‹é—´çš„é—´éš”æ—¶é—´**ã€‚éšç€ä¸æ–­å´©æºƒï¼Œå»¶è¿Ÿæ—¶é—´ä¼šæŒ‰ç…§ 0ã€10ã€20ã€80ã€160 ç§’è¿™æ ·å­å¢é•¿ï¼Œå¹¶æœ€ç»ˆæ”¶æ•›åœ¨ 300sã€‚æœ€å Kubelet å°†ä»¥ 300s ä¸ºé—´éš”æ—¶é—´å¯¹å®¹å™¨è¿›è¡Œæ— é™é‡å¯ï¼Œç›´åˆ°å®¹å™¨æ­£å¸¸è¿è¡Œæˆ–è¢«åˆ é™¤ã€‚

ä½¿ç”¨ describe å‘½ä»¤å¯ä»¥å®šä½å®¹å™¨å´©æºƒçš„åŸå› ã€‚

![code-14-8.png](./images/code-14-8.png)

å½“ OOMKilled çŠ¶æ€å‘Šè¯‰æˆ‘ä»¬å®¹å™¨æ­£å¼å› ä¸ºå†…å­˜ä¸è¶³è€Œè¢«ç³»ç»Ÿæ€æ‰ã€‚

#### 14.2.3 å®¹å™¨ä¸­çš„åº”ç”¨å¦‚ä½•çœ‹å¾… limits

å³ä½¿ä½ ä¸ºå®¹å™¨è®¾ç½®äº†æœ€å¤§å¯ç”¨å†…å­˜çš„é™é¢ï¼Œä½†åœ¨å®¹å™¨å†…éƒ¨çœ‹åˆ°çš„å§‹ç»ˆéƒ½ä¼šæ˜¯èŠ‚ç‚¹çš„å†…å­˜è€Œä¸æ˜¯å®¹å™¨æœ¬èº«çš„å†…å­˜ã€‚ä¸”åœ¨å®¹å™¨å†…åŒæ ·å¯ä»¥çœ‹åˆ°èŠ‚ç‚¹æ‰€æœ‰çš„ CPU æ ¸ã€‚è¿™ä¸€ç‚¹å¯¹äºä¸€äº›ä¾èµ–äºæœ¬æœºå†…å­˜é™é¢æ¥æ‰§è¡Œç¨‹åºçš„è¯­è¨€æ¥è¯´éå¸¸è‡´å‘½ï¼Œæ¯”å¦‚è¯´ä¾èµ– JVM æ¥æ‰§è¡Œåº”ç”¨çš„ä½ç‰ˆæœ¬ JAVAï¼Œå°±ä¼šç”±äºæ— æ³•è¯†åˆ«åˆ°å†…å­˜é™é¢è€Œç”³è¯·è¶…å‡ºé™é¢çš„å†…å­˜ï¼Œç„¶åè¢« OOM æ€æ­»ã€‚

è¿™ä¹Ÿæé†’äº†å¼€å‘è€…ï¼Œä¸è¦ä¾èµ–åº”ç”¨ç¨‹åºä»ç³»ç»Ÿä¸­è·å–ç¡¬ä»¶èµ„æºçš„å…·ä½“æƒ…å†µï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ Downward API å°† CPU é™é¢ä¼ é€’è‡³å®¹å™¨å¹¶ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ cgroup ç³»ç»Ÿç›´æ¥è·å–é…ç½®çš„ CPU é™åˆ¶ï¼Œåœ¨å®¹å™¨å†…æŸ¥çœ‹ä¸‹åˆ—æ–‡ä»¶ï¼š

- /sys/fs/cgroup/cpu/cpu.cfs_quota_us
- /sys/fs/cgroup/cpu/cpu.cfs_period_us

### 14.3 äº†è§£ pod QoS ç­‰çº§

å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ª podï¼Œpod A ä½¿ç”¨äº†èŠ‚ç‚¹å†…å­˜çš„ 90%ï¼Œpod B çªç„¶éœ€è¦æ¯”ä¹‹å‰æ›´å¤šçš„å†…å­˜ï¼Œè¿™æ—¶çš„èŠ‚ç‚¹æ— æ³•æä¾›è¶³é‡å†…å­˜ï¼Œé‚£ä¹ˆå“ªä¸ªå®¹å™¨ä¼šè¢«æ€æ‰å‘¢ï¼Ÿ

K8S é€šè¿‡ä¸€ç§åä¸º Qos çš„ç­‰çº§åˆ¶åº¦åˆ¶å®šå“ªç§ pod åœ¨è¯¥åœºæ™¯ä¸­ä¼˜å…ˆçº§æ›´é«˜ï¼ŒK8S å°† pod åˆ’åˆ†ä¸ºä¸‰ç§ QoS ç­‰çº§ï¼š

- BestEffortï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰
- Burstable
- Guaranteedï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰

#### 14.3.1 å®šä¹‰ pod çš„ QoS ç­‰çº§

QoS ç­‰çº§å¹¶ä¸æ¥è‡ªäºä¸€ä¸ªç‰¹å®šçš„ç‹¬ç«‹å­—æ®µï¼Œè€Œæ˜¯é€šè¿‡ requests å’Œ limits çš„é…ç½®æ¥å†³å®šã€‚

##### ä¸º pod åˆ†é… BestEffort ç­‰çº§

è¿™æ˜¯æœ€ä½ä¼˜å…ˆçº§çš„ QoSï¼Œä¼šåˆ†é…ç»™é‚£äº›**æ²¡æœ‰è®¾ç½®ä»»ä½• requests å’Œ limits çš„ pod**ã€‚å‰é¢ç« èŠ‚åˆ›å»ºçš„ pod éƒ½æ˜¯è¿™ä¸ªç­‰çº§ï¼Œè¯¥ç™»è®°è¿è¡Œçš„å®¹å™¨æ²¡æœ‰ä»»ä½•èµ„æºä¿è¯ï¼Œåœ¨éœ€è¦ä¸ºå…¶ä»– pod é‡Šæ”¾å†…å­˜æ—¶å®ƒä»¬ä¼šè¢«ç¬¬ä¸€æ‰¹æ€æ­»ã€‚ä¸è¿‡ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œå½“æœ‰å……è¶³çš„å¯ç”¨å†…å­˜æ—¶ï¼Œè¿™äº›å®¹å™¨å¯ä»¥ä½¿ç”¨ä»»æ„å¤šçš„å†…å­˜ã€‚

##### ä¸º pod åˆ†é… Guaranteed ç­‰çº§

è¿™æ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„ QoSï¼Œä¼šåˆ†é…ç»™é‚£äº›**æ‰€æœ‰èµ„æº request å’Œ limits ç›¸ç­‰çš„ pod**ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªå®¹å™¨éƒ½éœ€è¦è®¾ç½®èµ„æºé‡ï¼Œä¹Ÿå°±æ˜¯**æ¯ä¸ªå®¹å™¨çš„æ¯ç§èµ„æºçš„ requests å’Œ limits éƒ½å¿…é¡»ç›¸ç­‰**ã€‚è¿™äº› pod çš„å®¹å™¨å¯ä»¥ä½¿ç”¨å®ƒæ‰€ç”³è¯·çš„ç­‰é¢èµ„æºï¼Œä½†æ˜¯æ— æ³•æ¶ˆè€—æ›´å¤šçš„èµ„æºã€‚

##### ä¸º pod åˆ†é… Burstable ç­‰çº§

é™¤äº†ä»¥ä¸Šä¸¤ç§æ„å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„ pod éƒ½å±äºè¿™ä¸ªç™»è®°ï¼ŒåŒ…æ‹¬ï¼š

- å®¹å™¨çš„ requests å’Œ limits ä¸ç›¸åŒçš„å•å®¹å™¨ pod
- è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨åªå®šä¹‰äº† requests ä½†æ²¡æœ‰å®šä¹‰ limits çš„pod
- ä¸€ä¸ªå®¹å™¨çš„ requests å’Œ limitsï¼Œä½†å¦ä¸€ä¸ªå®¹å™¨ä¸æŒ‡å®š requests æˆ– limits çš„ podã€‚

Burstable pod å¯ä»¥è·å¾—å®ƒä»¬æ‰€ç”³è¯·çš„ç­‰é¢èµ„æºï¼Œå¹¶å¯ä»¥ä½¿ç”¨é¢å¤–çš„èµ„æºï¼ˆä¸è¶…è¿‡ limitsï¼‰

##### requests å’Œ limits ä¹‹é—´çš„å…³ç³»å¦‚ä½•å®šä¹‰ QoS ç­‰çº§

![14-4.png](./images/14-4.png)

![table-14-1.png](./images/table-14-1.png)

#### 14.3.2 å†…å­˜ä¸è¶³æ—¶å“ªä¸ªè¿›ç¨‹ä¼šè¢«æ€æ­»

BestEffort ç­‰çº§çš„ pod ä¼šé¦–å…ˆè¢«æ€æ‰ã€‚å…¶æ¬¡æ˜¯ Burstable ç­‰çº§ï¼Œæœ€åæ˜¯ Guaranteed ç­‰çº§ã€‚è€Œ Guaranteed çš„ pod åªæœ‰åœ¨ç³»ç»Ÿè¿›ç¨‹éœ€è¦å†…å­˜æ—¶æ‰ä¼šè¢«æ€æ‰ã€‚

##### å¦‚ä½•å¤„ç†ç›¸åŒ QoS ç­‰çº§çš„å®¹å™¨

æ¯ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç§°ä¸º OOMï¼ˆOutOfMemoryï¼‰åˆ†æ•°çš„å€¼ã€‚ç”±ä¸¤ä¸ªå‚æ•°è®¡ç®—å¾—å‡ºï¼š

- è¿›ç¨‹å·²æ¶ˆè€—å†…å­˜å ç”¨å†…å­˜çš„ç™¾åˆ†æ¯”
- åŸºäº pod QoS ç­‰çº§å’Œå®¹å™¨å†…å­˜ç”³è¯·é‡å›ºå®šçš„ OOM åˆ†æ•°è°ƒèŠ‚å› å­

å¯¹äºä¸¤ä¸ªåŒç­‰çº§çš„å•å®¹å™¨ podï¼Œç³»ç»Ÿä¼šæ€æ‰è¯¥ OOM åˆ†æ•°æ›´é«˜çš„ podã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ª pod ä¸­çš„ A å®¹å™¨ç”³è¯·äº† 1M çš„å†…å­˜ä½¿ç”¨äº† 900KBï¼Œç›¸å½“äºå ç”¨äº† 90% çš„ç”³è¯·é‡ã€‚è€Œ B å®¹å™¨ç”³è¯·äº† 2M çš„å†…å­˜ä½¿ç”¨äº† 1M å†…å­˜ï¼Œç›¸å½“äºå ç”¨äº† 50% çš„ç”³è¯·é‡ã€‚åˆ™å½“ K8S éœ€è¦æ€è¿›ç¨‹æ¥é‡Šæ”¾å†…å­˜æ—¶ï¼Œä¼šä¼˜å…ˆåˆ é™¤ A å®¹å™¨ä¸­çš„è¿›ç¨‹ã€‚å°½ç®¡åè€…æ¯”å‰è€…ä½¿ç”¨äº†æ›´å¤šå…†å­—èŠ‚çš„å†…å­˜ã€‚

### 14.4 ä¸ºå‘½åç©ºé—´ä¸­çš„ pod è®¾ç½®é»˜è®¤çš„ requests å’Œ limits

ä¸ºæ¯ä¸ªå®¹å™¨éƒ½è®¾ç½® requests å’Œ limits å¾ˆæœ‰å¿…è¦ï¼Œå¯æ˜¯æŒ¨ä¸ªè®¾ç½®æœªå…æ˜¾å¾—å¤ªéº»çƒ¦ã€‚é€šè¿‡ LimitRange èµ„æºï¼Œå¯ä»¥ä¸ºå‘½åç©ºé—´ä¸­çš„ pod ä¸­çš„å®¹å™¨è®¾ç½® requests å’Œ limit é»˜è®¤å€¼ã€‚

#### 14.4.1 LimitRange èµ„æºç®€ä»‹

![14-6.png](./images/14-6.png)

API æœåŠ¡å™¨æ¥æ”¶åˆ°å¸¦æœ‰ pod æè¿°ä¿¡æ¯çš„ POST è¯·æ±‚æ—¶ï¼ŒK8S ä¸­çš„ LimitRanger æ’ä»¶ä¼šå¯¹ pod spec è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒå¤±è´¥ï¼Œå°†ä¼šç›´æ¥æ‹’ç»ã€‚

å› æ­¤ LimitRange å¯¹è±¡çš„ä¸€ä¸ªå¹¿æ³›åº”ç”¨åœºæ™¯å°±æ˜¯é˜»æ­¢ç”¨æˆ·åˆ›å»ºå¤§äºå•ä¸ªèŠ‚ç‚¹èµ„æºé‡çš„ podã€‚

LimitRange éœ€è¦é›†ç¾¤é¢å¤–å¼€å¯æ’ä»¶æ¥è¿è¡Œã€‚

#### 14.4.2 LimitRange å¯¹è±¡çš„åˆ›å»º

LimitRange èµ„æºä¸­çš„ limits åº”ç”¨äºåŒä¸€ä¸ªå‘½åç©ºé—´ä¸­æ¯ä¸ªç‹¬ç«‹çš„ podã€å®¹å™¨ï¼Œæˆ–è€…å…¶ä»–ç±»å‹çš„å¯¹è±¡ã€‚ä½†å¹¶ä¸ä¼šé™åˆ¶è¿™ä¸ªå‘½åç©ºé—´ä¸­æ‰€æœ‰ pod å¯ç”¨èµ„æºçš„æ€»é‡ã€‚æ€»é‡æ˜¯åœ¨ ResourceQuota å¯¹è±¡ä¸­æŒ‡å®šçš„ï¼ˆåœ¨ 14.5 èŠ‚ä¸­è¿›è¡Œè¯´æ˜ï¼‰ã€‚

![code-14-10.png](./images/code-14-10.png)

ä¸Šé¢æ˜¯ä¸€ä¸ª limitRange çš„å®Œæ•´å®šä¹‰ï¼Œæ•´ä¸ª pod èµ„æºé™åˆ¶çš„æœ€å°å€¼å’Œæœ€å¤§å€¼æ˜¯å¯ä»¥é…ç½®çš„ã€‚å®ƒåº”ç”¨äº pod å†…æ‰€æœ‰å®¹å™¨çš„ requests å’Œ limits ä¹‹å’Œã€‚

æ­¤å¤–ï¼Œæ­£å¦‚ CPU å’Œå†…å­˜ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸º pod çš„æŒä¹…åŒ–å­˜å‚¨å¤§å°è¿›è¡Œé™åˆ¶ã€‚å¦‚æœä¸€ä¸ªå‘½åç©ºé—´ä¸­æœ‰å¤šä¸ªä¸åŒç§ç±»çš„ LimitRangeï¼ˆæ¯”å¦‚ä¸€ä¸ªç”¨äºå®¹å™¨é™åˆ¶ï¼Œå¦ä¸€ä¸ªç”¨äº PVC é™åˆ¶ï¼‰ï¼Œé‚£ä¹ˆä»–ä»¬ä¼šåœ¨æ ¡éªŒ pod æˆ– PVC åˆæ³•æ€§æ—¶è‡ªåŠ¨è¿›è¡Œåˆå¹¶ã€‚

#### 14.4.3 å¼ºåˆ¶è¿›è¡Œé™åˆ¶

å½“æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ª CPU ç”³è¯·é‡å¤§äº LimitRange çš„ pod æ—¶ï¼Œæ¯”å¦‚è¯´ LimitRange æœ€å¤šå…è®¸ 2 æ ¸ï¼Œè€Œåœ¨ pod çš„ yaml å¤§äºè¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆä½¿ç”¨`create`å‘½ä»¤åˆ›å»ºçš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚

#### 14.4.4 åº”ç”¨èµ„æº requests å’Œ limits çš„é»˜è®¤å€¼

è€Œåƒä¸Šé¢æ‰€è¯´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæ‹¥æœ‰ LimitRange èµ„æºçš„å‘½åç©ºé—´ä¸­ä¸ç‰¹æ®ŠæŒ‡å®šæ¯ä¸ª pod çš„ request å’Œ limitï¼Œé‚£ä¹ˆä»–ä»¬çš„é»˜è®¤å€¼å°±ä¼šæ˜¯è¿™ä¸ª LimitRange æ‰€è®¾å®šçš„é»˜è®¤å€¼ã€‚

è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸éœ€è¦ç‰¹æ®Šæ›´æ”¹ pod çš„ manifestï¼Œå°±èƒ½åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­ä¸ºå…¶åˆ†é…ä¸åŒçš„é™åˆ¶ï¼Œè®©å…¶ä¸“æ³¨äºå®¹å™¨æœ¬èº«ï¼ŒåŠ¨æ€é…ç½®ä¸åŒçš„èµ„æºé™åˆ¶ã€‚

### 14.5 é™åˆ¶å‘½åç©ºé—´ä¸­çš„å¯ç”¨èµ„æºæ€»é‡

ä½†è¦æ³¨æ„çš„æ˜¯ï¼ŒLimitRange åªåº”ç”¨äºå•ç‹¬çš„ podï¼Œåªè®¾ç½®äº† LimitRange çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¾ç„¶å¯èƒ½å› ä¸ºåˆ›å»ºäº†å¤§é‡çš„ pod è€Œåƒæ‰äº†é›†ç¾¤çš„æ‰€æœ‰å¯ç”¨èµ„æºã€‚ä¸ºäº†è§£å†³è¿™ç§æ–¹æ³•ï¼Œéœ€è¦ç”¨åˆ° ResourceQuota èµ„æºï¼Œç”¨äºé™åˆ¶å‘½åç©ºé—´ä¸­çš„å¯ç”¨èµ„æºæ€»é‡ã€‚

ResourceQuota èµ„æºåŒæ ·ä¹Ÿéœ€è¦é›†ç¾¤å¼€å¯é¢å¤–çš„æ§åˆ¶æ’ä»¶ã€‚

#### 14.5.1 ResourceQuota èµ„æºä»‹ç»

ResourceQuota æ’ä»¶å’Œ LimitRange ç±»ä¼¼ï¼Œéƒ½ä¼šåœ¨åˆ›å»º pod æ—¶è¿›è¡Œæ£€æŸ¥ã€‚è‹¥è¯¥ pod æ˜¯ä¼šå¼•èµ·æ€»èµ„æºé‡è¶…å‡ºé™åˆ¶çš„æƒ…å†µï¼Œè¯¥åˆ›å»ºè¯·æ±‚å°±ä¼šè¢«æ‹’ç»ã€‚å› ä¸ºåªä¼šåœ¨åˆ›å»ºæ—¶è¿›è¡Œæ£€æŸ¥ï¼Œæ‰€ä»¥ ResourceQuota ä¸ä¼šå½±å“å·²ç»å­˜åœ¨çš„ podï¼Œåªä¼šå¯¹å…¶ååˆ›å»ºçš„ pod äº§ç”Ÿå½±å“ã€‚

##### ä¸º CPU å’Œå†…å­˜åˆ›å»º ResourceQuota

![code-14-13.png](./images/code-14-13.png)

ä¸Šé¢åˆ†åˆ«å®šä¹‰äº† CPU å’Œå†…å­˜çš„ requests å’Œ limits æ€»é‡ï¼Œ**è€Œä¸æ˜¯ç®€å•åœ°ä¸ºæ¯ç§èµ„æºåªå®šä¹‰ä¸€ä¸ªæ€»é‡**ã€‚

è¯¥ ReourceQuota è®¾ç½®äº†å‘½åç©ºé—´ä¸­æ‰€æœ‰ pod æœ€å¤šå¯ç”³è¯·çš„ CPU æ•°é‡ä¸º 400 æ¯«æ ¸ï¼Œlimits æœ€å¤§æ€»é‡ä¸º 600 æ¯«æ ¸ã€‚å¯¹äºå†…å­˜ï¼Œè®¾ç½®æ‰€æœ‰ requests æœ€å¤§æ€»é‡ä¸º 200MiBï¼Œlimits ä¸º 500MiBã€‚

å’Œ LimitRange ä¸€æ ·ï¼Œå¯ä»¥æ‰§è¡Œ`kubectl describe`æ¥æŸ¥çœ‹å½“å‰é…é¢å·²ç»ä½¿ç”¨äº†å¤šå°‘ã€‚

![code-14-14.png](./images/code-14-14.png)

##### ä¸ ResourceQuota åŒæ—¶åˆ›å»º LimitRange

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ›å»º ResourceQuota å¾€å¾€è¿˜éœ€è¦éšä¹‹åˆ›å»ºä¸€ä¸ª LimitRangeã€‚å‡è®¾æ²¡æœ‰é…ç½®ï¼Œæ²¡æœ‰æŒ‡å®š requests å’Œ limits çš„ pod å°†æ— æ³•æˆåŠŸåˆ›å»ºã€‚

#### 14.5.2 ä¸ºæŒä¹…åŒ–å­˜å‚¨æŒ‡å®šé…é¢

RQ åŒæ ·å¯ä»¥é™åˆ¶å‘½åç©ºé—´ä¸­æœ€å¤šå¯ä»¥å£°æ˜çš„æŒä¹…åŒ–å­˜å‚¨æ€»é‡ã€‚

![code-14-15.png](./images/code-14-15.png)

å¦‚ä¸Šé¢æ‰€ç¤ºçš„ä¾‹å­ä¸­å¯ç”³è¯·çš„ PVC æ€»é‡è¢«é™åˆ¶ä¸º 500GiBï¼ˆé€šè¿‡åœ¨ pod ä¸­çš„ requests.storage é…ç½®ï¼‰ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡åŠ¨æ€å£°æ˜ï¼ˆStorageClassï¼‰çš„ SSD å­˜å‚¨æ€»é‡ä¸º 300GiBï¼Œä½æ€§èƒ½çš„ HDD å­˜å‚¨é™åˆ¶ä¸º 1TBã€‚

#### 14.5.3 é™åˆ¶å¯åˆ›å»ºçš„ä¸ªæ•°

RQ åŒæ ·å¯ä»¥é™åˆ¶å‘½åç©ºé—´ä¸­çš„ podã€RCã€Service ä»¥åŠå…¶ä»–å¯¹è±¡çš„ä¸ªæ•°ã€‚

![code-14-16.png](./images/code-14-16.png)

#### 14.5.4 ä¸ºç‰¹å®šçš„ pod çŠ¶æ€æˆ–è€… QoS ç­‰çº§æŒ‡å®šé…é¢

![code-14-17.png](./images/code-14-17.png)

### 14.6 ç›‘æ§ pod çš„èµ„æºä½¿ç”¨é‡

å¦‚æœ requests è®¾ç½®å¾—å¤ªé«˜ï¼Œé›†ç¾¤èŠ‚ç‚¹åˆ©ç”¨ç‡å°±ä¼šæ¯”è¾ƒä½ã€‚å¦‚æœè®¾ç½®å¾—å¤ªä½ï¼Œåº”ç”¨å°±ä¼šå¤„äº CPU é¥¥é¥¿çŠ¶æ€ï¼Œç”šè‡³å¾ˆå®¹æ˜“è¢« OOM Killer æ€æ­»ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰¾åˆ° requests å’Œ limits çš„æœ€ä½³é…ç½®å‘¢ã€‚

ç­”æ¡ˆæ˜¯é€šè¿‡å¯¹å®¹å™¨åœ¨æœŸæœ›è´Ÿè½½ä¸‹çš„èµ„æºå®é™…ä½¿ç”¨ç‡ï¼Œç„¶åæ‰¾åˆ°è¿™ä¸ªæœ€ä½³é…ç½®ã€‚è€Œå¦‚æœè¿™ä¸ªåº”ç”¨æš´éœ²åœ¨å…¬ç½‘ï¼Œå°±åº”è¯¥ä¿æŒç›‘æ§å¹¶ä¸”åœ¨éœ€è¦çš„æ—¶å€™å¯¹èµ„æºçš„ requests å’Œ limits è¿›è¡Œè°ƒèŠ‚ã€‚

#### 14.6.1 æ”¶é›†ã€è·å–å®é™…èµ„æºä½¿ç”¨æƒ…å†µ

å¦‚ä½•ç›‘æ§åœ¨ K8S ä¸­è¿è¡Œçš„åº”ç”¨å‘¢ï¼ŒKubelet è‡ªèº«å°±åŒ…å«äº†ä¸€ä¸ªåä¸º cAdvisor çš„ agentï¼Œå®ƒä¼šæ”¶é›†å½“å‰èŠ‚ç‚¹ï¼Œå’ŒèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰çš„èµ„æºæ¶ˆè€—æƒ…å†µã€‚é›†ä¸­ç»Ÿè®¡æ•´ä¸ªé›†ç¾¤çš„ç›‘æ§ä¿¡æ¯è¿˜éœ€è¦è¿è¡Œä¸€ä¸ªå«ä½œ Heapster çš„é™„åŠ ç»„ä»¶ã€‚

Heapster ä»¥ pod çš„æ–¹å¼è¿è¡Œåœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡æ™®é€šçš„ Service æš´éœ²æœåŠ¡ï¼Œä½¿å¤–éƒ¨å¯ä»¥é€šè¿‡ä¸€ä¸ªç¨³å®šçš„ IP åœ°å€è®¿é—®ã€‚å®ƒä¼šä»é›†ç¾¤ä¸­æ‰€æœ‰çš„ cAdvisor æ”¶é›†æ•°æ®å¹¶å±•ç¤ºã€‚

![14-8.png](./images/14-8.png)

pod å’Œ pod ä¸­çš„å®¹å™¨å¹¶ä¸ä¼šæ„ŸçŸ¥åˆ° cAdvisor çš„å­˜åœ¨ï¼ŒcAdvisor ä¹Ÿæ„ŸçŸ¥ä¸åˆ° Heapster çš„å­˜åœ¨ã€‚Heapster ä¼šä¸»åŠ¨è¯·æ±‚æ‰€æœ‰çš„ cAdvisorï¼Œè€Œ cAdvisor æ— é¡»é€šè¿‡ä¸ pod å®¹å™¨å†…è¿›ç¨‹é€šä¿¡å°±å¯ä»¥æ”¶é›†åˆ°å®¹å™¨å’ŒèŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æ•°æ®ã€‚

##### å¯ç”¨ Heapster

å¦‚æœé›†ç¾¤è¿è¡Œåœ¨è°·æ­Œäº‘å¹³å°ä¸Šï¼ŒHeapster é»˜è®¤ä¼šå¯ç”¨ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ Minikubeï¼Œåˆ™éœ€è¦é€šè¿‡æ’ä»¶å¼€å¯ã€‚

```shell
$ minikube addons enable heapster
âŒ›  enable metrics-server addon instead of heapster addon because heapster is deprecated
ğŸŒŸ  å¯åŠ¨ 'metrics-server' æ’ä»¶
```

##### æ˜¾ç¤ºé›†ç¾¤èŠ‚ç‚¹çš„ CPU å’Œå†…å­˜ä½¿ç”¨é‡

ä½¿ç”¨`kubectl top`å‘½ä»¤å¯ä»¥è·å¾—èŠ‚ç‚¹å’Œå•ä¸ª pod çš„èµ„æºç”¨é‡ã€‚

```shell
# æ˜¾ç¤ºèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰ pod å½“å‰çš„ CPU å’Œå†…å­˜çš„å®é™…ä½¿ç”¨é‡
$ kubectl top node
NAME       CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
minikube   195m         9%     1726Mi          44%

# æ˜¾ç¤ºæ‰€æœ‰å‘½åç©ºé—´ä¸­ pod çš„ç”¨é‡
$ kubectl top pod --all-namespaces
NAMESPACE              NAME                                        CPU(cores)   MEMORY(bytes)
kube-system            coredns-6c76c8bb89-qqjql                    3m           8Mi
kube-system            etcd-minikube                               16m          35Mi
kube-system            ingress-nginx-controller-789d9c4dc-r6v8r    1m           64Mi
kube-system            kube-apiserver-minikube                     51m          270Mi
kube-system            kube-controller-manager-minikube            19m          40Mi
kube-system            kube-proxy-7xkk6                            0m           11Mi
kube-system            kube-scheduler-minikube                     2m           12Mi
kube-system            metrics-server-868987f44f-nclhx             0m           10Mi
kube-system            storage-provisioner                         1m           8Mi
kubernetes-dashboard   dashboard-metrics-scraper-c95fcf479-qv5m2   0m           4Mi
kubernetes-dashboard   kubernetes-dashboard-5c448bc4bf-j8lfg       0m           6Mi
```

PSï¼šæœ‰æ—¶å€™æ‰§è¡Œä¼šé‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š

```shell
# æŸ¥çœ‹æ‰€æœ‰ pod å…¶ä¸­æ‰€æœ‰å®¹å™¨çš„èµ„æºç”¨é‡
$ kubectl top pod --containers=true --all-namespaces
W0313 23:23:42.213496    5833 top_pod.go:274] Metrics not available for pod default/demo-statefulset-0, age: 523h26m44.213057s
error: Metrics not available for pod default/demo-statefulset-0, age: 523h26m44.213057s
```

è¿™ç§æƒ…å†µå¹¶ä¸ä»£è¡¨çœŸçš„å‡ºé”™ï¼Œè€Œæ˜¯ Heapster æ­£åœ¨è¿›è¡Œæ•°æ®æ±‡æ€»ï¼Œæ— æ³•å°†ç»“æœç«‹åˆ»è¿”å›ã€‚è¿™ç§æƒ…å†µä¸‹åªè¦ç­‰å¾…ä¸€ä¼šå„¿å†é‡æ–°æ‰§è¡Œå‘½ä»¤ã€‚

#### 14.6.2 ä¿å­˜å¹¶åˆ†æå†å²èµ„æºçš„ä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯

`top`å‘½ä»¤ä»…ä»…åªå±•ç¤ºäº†å½“å‰çš„èµ„æºä½¿ç”¨é‡ï¼Œä½†å¹¶ä¸ä¼šæ˜¾ç¤ºä»ä¸€å°æ—¶ã€ä¸€å¤©æˆ–è€…ä¸€å‘¨å‰åˆ°ç°åœ¨ pod çš„ CPU å’Œå†…å­˜ä½¿ç”¨äº†å¤šå°‘ã€‚äº‹å®ä¸Šæ— è®ºæ˜¯ cAdvisor è¿˜æ˜¯ Heapster éƒ½åªä¼šä¿å­˜ä¸€ä¸ªå¾ˆçŸ­æ—¶é—´çª—çš„èµ„æºä½¿ç”¨é‡æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´äº‘å¹³å°æœåŠ¡æä¾›å•†éƒ½ä¼šæä¾›ä¸€äº›é¢å¤–å·¥å…·æ¥å¯¹é›†ç¾¤è¿›è¡Œç›‘æ§ï¼ˆæ¯”å¦‚è°·æ­Œäº‘å¹³å°çš„ Google Cloud Monitoringï¼‰ï¼Œå¦‚æœæ˜¯æœ¬åœ°çš„ K8S é›†ç¾¤ï¼Œäººä»¬å¾€å¾€ä¼šä½¿ç”¨ InfluxDB æ¥å­˜å‚¨æ•°æ®ï¼Œç„¶åä½¿ç”¨ Grafana å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–å’Œåˆ†æã€‚

##### InfluxDB å’Œ Grafana

InfluxDB æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨åº”ç”¨æŒ‡æ ‡ä»¥åŠå…¶ä»–ç›‘æ§æ•°æ®çš„å¼€æºçš„æ—¶è®¸æ•°æ®åº“ï¼ŒGrafana åˆ™æ˜¯ä¸€ä¸ªåŸºäº web çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å¥—ä»¶ã€‚è¿™ä¸¤è€…éƒ½æ˜¯å¼€æºçš„ã€‚

InfluxDB å’Œ Grafana éƒ½å¯ä»¥ä»¥ pod è¿è¡Œï¼Œéƒ¨ç½²ååˆ†æ–¹ä¾¿ï¼Œéƒ¨ç½²æ–‡ä»¶å¯ä»¥é€šè¿‡ Heapster çš„ Git ä»“åº“è·å–ã€‚è€Œå¦‚æœä½¿ç”¨çš„æ˜¯ Minikubeï¼Œåˆ™ç”šè‡³æ— éœ€éƒ¨ç½²ï¼Œåœ¨å¯ç”¨ Heapster çš„æ—¶å€™å°±ä¼šéšä¹‹å¼€å¯äº†ã€‚

![14-9.png](./images/14-9.png)

ä½¿ç”¨`kubectl cluster-info`æ¥æŸ¥çœ‹ Grafana web æ§åˆ¶å°çš„ URLï¼Œç„¶åè¿›è¡Œè®¿é—®ï¼Œå°±å¯ä»¥æŸ¥çœ‹ pod å®æ—¶çš„æµé‡æ•°æ®äº†ã€‚

![14-10.png](./images/14-10.png)

> PSï¼šä½¿ç”¨ minikube æ—¶ï¼Œgrafana çš„æ§åˆ¶å°é€šè¿‡ NodePort Service æš´éœ²ï¼Œå¯ä»¥ä½¿ç”¨`minikube service monitoring-grafana -n kube-system`å‘½ä»¤æ¥æ‰“å¼€ã€‚ï¼ˆä½†å¾ˆé—æ†¾åœ¨ç¬”è€…çš„ minikube ç‰ˆæœ¬ v1.13.1 æ— æ³•æ‰“å¼€ï¼ŒåŸå› å¤§æ¦‚æ˜¯è¿™ä¸ªç‰ˆæœ¬ heapster æ’ä»¶å·²ç»è¢«åºŸå¼ƒäº†ï¼Œæ”¹ç”¨äº† metrics-serverï¼ŒQAQï¼‰